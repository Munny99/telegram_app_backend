<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶π‡ßã‡¶Æ - Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #1a1a2e;
            color: #fff;
            font-family: 'Noto Sans Bengali', sans-serif;
            overflow-x: hidden;
        }

        .home-container {
            min-height: 100vh;
            background: #1a1a2e;
            padding-bottom: 80px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 20px;
            border-radius: 0 0 40px 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .welcome-text { font-size: 0.9rem; color: rgba(255, 255, 255, 0.8); }

        .notification-icon {
            width: 40px; height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        .notification-icon:hover { background: rgba(255, 255, 255, 0.2); transform: scale(1.1); }

        .profile-section { display: flex; align-items: center; gap: 15px; }

        .avatar {
            width: 70px; height: 70px;
            border-radius: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            font-weight: 700;
        }

        .profile-details h2 { font-size: 1.4rem; margin-bottom: 5px; }
        .verified { color: #4ade80; font-size: 1rem; }
        .user-id { font-size: 0.85rem; color: rgba(255, 255, 255, 0.7); }

        /* Balance Card */
        .balance-card {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%);
            border-radius: 25px;
            padding: 25px;
            margin: 20px;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
            position: relative;
            overflow: hidden;
        }
        .balance-card::before {
            content: 'üí∞';
            position: absolute;
            font-size: 120px;
            right: -20px; top: -30px;
            opacity: 0.1;
        }
        .balance-label { font-size: 0.9rem; color: rgba(255, 255, 255, 0.9); margin-bottom: 8px; }
        .balance-amount { font-size: 2.5rem; font-weight: 700; margin-bottom: 15px; }
        .balance-actions { display: flex; gap: 10px; }
        .balance-btn {
            flex: 1;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 10px;
            border-radius: 12px;
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            font-family: 'Noto Sans Bengali', sans-serif;
        }
        .balance-btn:hover { background: rgba(255, 255, 255, 0.3); transform: translateY(-2px); }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 0 20px;
            margin-bottom: 20px;
        }
        .stat-box {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(30, 60, 114, 0.3);
            transition: all 0.3s;
        }
        .stat-box:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(30, 60, 114, 0.5); }
        .stat-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .stat-value { font-size: 1.8rem; font-weight: 700; color: #4ade80; margin-bottom: 5px; }
        .stat-label { font-size: 0.85rem; color: rgba(255, 255, 255, 0.8); }
        .progress-bar {
            width: 100%; height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            margin-top: 10px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ade80, #22c55e);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* Referral Card */
        .referral-card {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            border-radius: 25px;
            padding: 25px;
            margin: 0 20px 20px;
            box-shadow: 0 10px 30px rgba(78, 205, 196, 0.3);
            position: relative;
            overflow: hidden;
        }
        .referral-card::before {
            content: 'üéÅ';
            position: absolute;
            font-size: 100px;
            right: -10px; top: -20px;
            opacity: 0.15;
        }
        .referral-title {
            font-size: 1.3rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .referral-description {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 15px;
            line-height: 1.5;
        }
        .bonus-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.25);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 700;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
        }
        .link-container {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
        }
        .link-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            font-size: 0.85rem;
            outline: none;
        }
        .copy-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            width: 40px; height: 40px;
            border-radius: 10px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .copy-btn:hover { background: rgba(255, 255, 255, 0.5); transform: rotate(10deg); }
        .share-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .share-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 12px;
            border-radius: 12px;
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: 'Noto Sans Bengali', sans-serif;
        }
        .share-btn:hover { background: rgba(255, 255, 255, 0.35); transform: translateY(-2px); }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0; left: 0; width: 100%;
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(78, 205, 196, 0.2);
            display: flex;
            justify-content: space-around;
            padding: 15px 0 10px;
            z-index: 100;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.3);
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            color: rgb(255, 255, 255);
            font-size: 0.75rem;
            transition: all 0.3s;
            cursor: pointer;
            padding: 5px 15px;
            border-radius: 12px;
        }
        .nav-icon { font-size: 1.5rem; }
        .nav-item.active { color: #ff6b6b; }
        .nav-item.active .nav-icon { transform: scale(1.2); }
        .nav-item:hover { color: #ff6b6b; }

        .loading {
            text-align: center;
            padding: 40px;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #4ade80;
            border-radius: 50%;
            width: 50px; height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect } = React;

    const HomePage = () => {
        const [user, setUser] = useState(null);
        const [loading, setLoading] = useState(true);
        const [activeNav, setActiveNav] = useState('home');

        const API_BASE_URL = '/api/telegram';
        const tg = window.Telegram?.WebApp;

        useEffect(() => {
            if (tg) {
                tg.expand();
                tg.ready();
            }
            authenticateUser();
        }, []);

        const authenticateUser = async () => {
            try {
                setLoading(true);
                const initData = tg?.initData || '';

                const response = await fetch(`${API_BASE_URL}/auth`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ initData })
                });

                if (response.ok) {
                    const userData = await response.json();
                    setUser(userData);
                }
            } catch (err) {
                console.error('Auth error:', err);
            } finally {
                setLoading(false);
            }
        };

        const copyLink = () => {
            const referralLink = `https://t.me/your_bot?start=${user?.referralCode}`;
            navigator.clipboard.writeText(referralLink);
            if (tg) {
                tg.showAlert('‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‚úÖ');
            }
        };

        const shareLink = () => {
            const referralLink = `https://t.me/your_bot?start=${user?.referralCode}`;
            const message = `‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡¶® ‡¶è‡¶¨‡¶Ç ‡ß≥80 ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶æ‡¶®! ${referralLink}`;

            if (tg) {
                tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(referralLink)}&text=${encodeURIComponent(message)}`);
            }
        };

        const adsProgress = user ? (user.completedTasks / user.totalTasks) * 100 : 0;

        if (loading) {
            return (
                <div className="home-container">
                    <div className="loading">
                        <div className="spinner"></div>
                        <p style={{marginTop: '20px'}}>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                    </div>
                </div>
            );
        }

        return (
            <div className="home-container">
                {/* Header */}
                <div className="header">
                    <div className="header-top">
                        <div className="welcome-text">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ üëã</div>
                        <div className="notification-icon">üîî</div>
                    </div>
                    <div className="profile-section">
                        <div className="avatar">
                            <span>{user?.firstName?.substring(0, 2).toUpperCase()}</span>
                        </div>
                        <div className="profile-details">
                            <h2>{user?.firstName} <span className="verified">‚úî</span></h2>
                            <div className="user-id">ID: {user?.telegramId}</div>
                        </div>
                    </div>
                </div>

                {/* Balance Card */}
                <div className="balance-card">
                    <div className="balance-label">‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</div>
                    <div className="balance-amount">‡ß≥ {parseFloat(user?.totalEarnings || 0).toFixed(2)}</div>
                    <div className="balance-actions">
                        <button className="balance-btn" onClick={() => alert('‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶Ü‡¶∏‡¶õ‡ßá')}>
                            üí≥ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞
                        </button>
                        <button className="balance-btn" onClick={() => alert('‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶Ü‡¶∏‡¶õ‡ßá')}>
                            üìä ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏
                        </button>
                    </div>
                </div>

                {/* Stats Grid */}
                <div className="stats-grid">
                    <div className="stat-box">
                        <div className="stat-icon">üì∫</div>
                        <div className="stat-value">{user?.completedTasks}/{user?.totalTasks}</div>
                        <div className="stat-label">‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®</div>
                        <div className="progress-bar">
                            <div className="progress-fill" style={{width: `${adsProgress}%`}}></div>
                        </div>
                    </div>
                    <div className="stat-box">
                        <div className="stat-icon">üë•</div>
                        <div className="stat-value">{user?.totalReferrals || 0}</div>
                        <div className="stat-label">‡¶Æ‡ßã‡¶ü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞</div>
                    </div>
                    <div className="stat-box">
                        <div className="stat-icon">üéØ</div>
                        <div className="stat-value">{user?.completedTasks || 0}</div>
                        <div className="stat-label">‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</div>
                    </div>
                    <div className="stat-box">
                        <div className="stat-icon">‚≠ê</div>
                        <div className="stat-value">{parseFloat(user?.totalEarnings || 0).toFixed(0)}</div>
                        <div className="stat-label">‡¶Æ‡ßã‡¶ü ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü</div>
                    </div>
                </div>

                {/* Referral Card */}
                <div className="referral-card">
                    <div className="referral-title">üéÅ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶ï‡ßá ‡¶Ü‡¶Æ‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</div>
                    <div className="referral-description">
                        ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶æ‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø <strong>‡ß≥80</strong> ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶æ‡¶®!
                    </div>
                    <div className="bonus-badge">üíµ ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá ‡ß≥80 ‡¶¨‡ßã‡¶®‡¶æ‡¶∏</div>
                    <div className="link-container">
                        <input
                            type="text"
                            className="link-input"
                            readOnly
                            value={`https://t.me/your_bot?start=${user?.referralCode || 'XXXXXX'}`}
                        />
                        <button className="copy-btn" onClick={copyLink}>üìã</button>
                    </div>
                    <div className="share-buttons">
                        <button className="share-btn" onClick={copyLink}>
                            üîó ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®
                        </button>
                        <button className="share-btn" onClick={shareLink}>
                            üì§ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
                        </button>
                    </div>
                </div>

                {/* Bottom Navigation */}
                <nav className="bottom-nav">
                    <div className={`nav-item ${activeNav === 'home' ? 'active' : ''}`} onClick={() => setActiveNav('home')}>
                        <div className="nav-icon">üè°</div>
                        <span>‡¶π‡ßã‡¶Æ</span>
                    </div>
                    <div className={`nav-item ${activeNav === 'task' ? 'active' : ''}`} onClick={() => window.location.href = '/tasks.html'}>
                        <div className="nav-icon">üìù</div>
                        <span>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</span>
                    </div>
                    <div className={`nav-item ${activeNav === 'refer' ? 'active' : ''}`} onClick={() => setActiveNav('refer')}>
                        <div className="nav-icon">üîó</div>
                        <span>‡¶∞‡ßá‡¶´‡¶æ‡¶∞</span>
                    </div>
                    <div className={`nav-item ${activeNav === 'withdraw' ? 'active' : ''}`} onClick={() => setActiveNav('withdraw')}>
                        <div className="nav-icon">üí∞</div>
                        <span>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</span>
                    </div>
                    <div className={`nav-item ${activeNav === 'history' ? 'active' : ''}`} onClick={() => setActiveNav('history')}>
                        <div className="nav-icon">üïì</div>
                        <span>‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø</span>
                    </div>
                </nav>
            </div>
        );
    };

    ReactDOM.render(<HomePage />, document.getElementById('root'));
</script>
</body>
</html>